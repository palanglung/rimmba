{% doc %}
  @prompt
    Create a new multi-tiles section.
    
    OVERALL PURPOSE
    This section renders a container of tiles (1–9).
    Each tile links to a selected Shopify Page.
    Each tile can automatically inherit page data or allow manual override per field.
    The layout supports configurable grid and optional masonry behavior.
    All background images must be lazy-loaded and use object-fit: cover.
    
    ────────────────────────────
    
    SECTION SETTINGS (CONTAINER LEVEL)
    
    Width:
    - narrow
    - fluid
    - full
    
    Tile count:
    - range selector
    - min: 1
    - max: 9
    - controls how many tiles render (render only first N blocks based on this value)
    
    Layout:
    - Masonry (checkbox)
    - Number of columns (range or number input)
    - Number of rows (range or number input)
    
    Layout behavior:
    - Grid is based on selected rows and columns.
    - When Masonry is disabled:
      Tiles render normally in grid order.
    - When Masonry is enabled:
      The first tile occupies the first column.
      It spans all selected rows.
      Remaining tiles distribute in remaining columns according to selected rows.
    - Masonry only applies when columns > 1.
    
    ────────────────────────────
    
    BLOCK STRUCTURE (TILES)
    
    Allow up to 9 blocks.
    
    Each block must contain:
    
    Page:
    - Page picker (Shopify Pages only)
    - Required for rendering
    
    Title:
    - Text input (optional)
    - If not blank → render manual title
    - If blank → render selected page title
    
    Description:
    - Textarea (optional)
    - If not blank → render manual description
    - If blank → render page meta description
    
    Background image:
    - Image picker (optional)
    - If not blank → render selected image
    - If blank → render page featured image
    
    Link:
    - Entire tile is clickable
    - Links to selected page URL
    
    Button:
    - Button text (optional)
    - If blank → do not render button
    - If not blank → render button linking to selected page URL
    
    Button style:
    - filled
    - outline
    - text
    
    Button alignment:
    - left
    - center
    - right
    - full width
    
    Color scheme:
    - Use native Shopify color_scheme setting type
    - Applied per tile
    
    ────────────────────────────
    
    RENDERING REQUIREMENTS
    
    - Images must be lazy-loaded.
    - Use responsive image handling.
    - Background images must use object-fit: cover.
    - Section must be fully compatible with OS 2.0 schema structure.
    - Blocks must support drag-and-drop ordering.
    - Only render blocks up to selected Tile count.
{% enddoc %}
{% liquid
  assign ai_gen_id = block.id | replace: '_', '' | downcase
%}

{% style %}
  .ai-page-tile-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    min-height: 400px;
    text-decoration: none;
    transition: transform 0.3s ease;
    width: 100%;
  }

  .ai-page-tile-{{ ai_gen_id }}:hover {
    transform: scale(1.02);
  }

  .ai-page-tile-background-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .ai-page-tile-background-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-page-tile-content-{{ ai_gen_id }} {
    position: relative;
    z-index: 2;
    padding: 40px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ai-page-tile-title-{{ ai_gen_id }} {
    font-size: 32px;
    font-weight: 700;
    margin: 0;
    line-height: 1.2;
    text-transform: uppercase;
  }

  .ai-page-tile-description-{{ ai_gen_id }} {
    font-size: 16px;
    line-height: 1.6;
    margin: 0;
    max-width: 600px;
  }

  .ai-page-tile-button-wrapper-{{ ai_gen_id }} {
    margin-top: 12px;
  }

  .ai-page-tile-button-{{ ai_gen_id }} {
    display: inline-block;
    padding: 14px 32px;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
  }

  .ai-page-tile-button-{{ ai_gen_id }}.filled {
    background-color: rgba(0, 0, 0, 0.9);
    color: #ffffff;
    border: 2px solid transparent;
  }

  .ai-page-tile-button-{{ ai_gen_id }}.filled:hover {
    background-color: rgba(0, 0, 0, 1);
  }

  .ai-page-tile-button-{{ ai_gen_id }}.outline {
    background-color: transparent;
    border: 2px solid currentColor;
  }

  .ai-page-tile-button-{{ ai_gen_id }}.outline:hover {
    background-color: rgba(255, 255, 255, 0.15);
  }

  .ai-page-tile-button-{{ ai_gen_id }}.text {
    background-color: transparent;
    border: none;
    padding: 8px 0;
    text-decoration: underline;
  }

  .ai-page-tile-button-wrapper-{{ ai_gen_id }}.left {
    text-align: left;
  }

  .ai-page-tile-button-wrapper-{{ ai_gen_id }}.center {
    text-align: center;
  }

  .ai-page-tile-button-wrapper-{{ ai_gen_id }}.right {
    text-align: right;
  }

  .ai-page-tile-button-wrapper-{{ ai_gen_id }}.full .ai-page-tile-button-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    text-align: center;
  }

  .ai-page-tile-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-page-tile-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 300px;
    max-height: 300px;
    opacity: 0.2;
  }

  .ai-page-tile-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 4px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  @media screen and (max-width: 768px) {
    .ai-page-tile-{{ ai_gen_id }} {
      min-height: 300px;
    }

    .ai-page-tile-content-{{ ai_gen_id }} {
      padding: 24px;
    }

    .ai-page-tile-title-{{ ai_gen_id }} {
      font-size: 24px;
    }

    .ai-page-tile-description-{{ ai_gen_id }} {
      font-size: 14px;
    }

    .ai-page-tile-button-{{ ai_gen_id }} {
      padding: 12px 24px;
      font-size: 13px;
    }
  }
{% endstyle %}

{% liquid
  assign page = block.settings.page
  assign title = block.settings.title
  assign description = block.settings.description
  assign background_image = block.settings.background_image
  assign button_text = block.settings.button_text
  assign button_style = block.settings.button_style
  assign button_alignment = block.settings.button_alignment

  if title == blank and page
    assign title = page.title
  endif

  if description == blank and page
    assign description = page.metafields.descriptors.description.value
  endif

  if background_image == blank and page
    assign background_image = page.image
  endif

  if page
    assign page_url = page.url
  else
    assign page_url = '#'
  endif
%}

<a
  href="{{ page_url }}"
  class="ai-page-tile-{{ ai_gen_id }} color-{{ block.settings.color_scheme }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-page-tile-background-{{ ai_gen_id }}">
    {% if background_image %}
      <img
        src="{{ background_image | image_url: width: 1200 }}"
        alt="{{ background_image.alt | escape }}"
        loading="lazy"
        width="{{ background_image.width }}"
        height="{{ background_image.height }}"
      >
    {% else %}
      <div class="ai-page-tile-placeholder-{{ ai_gen_id }}">
        {{ 'image' | placeholder_svg_tag }}
        {% unless page %}
          <div class="ai-page-tile-empty-state-{{ ai_gen_id }}">
            Select a page to get started
          </div>
        {% endunless %}
      </div>
    {% endif %}
  </div>

  <div class="ai-page-tile-content-{{ ai_gen_id }}">
    {% if title != blank %}
      <h3 class="ai-page-tile-title-{{ ai_gen_id }}">{{ title }}</h3>
    {% endif %}

    {% if description != blank %}
      <p class="ai-page-tile-description-{{ ai_gen_id }}">{{ description }}</p>
    {% endif %}

    {% if button_text != blank %}
      <div class="ai-page-tile-button-wrapper-{{ ai_gen_id }} {{ button_alignment }}">
        <span class="ai-page-tile-button-{{ ai_gen_id }} {{ button_style }}">
          {{ button_text }}
        </span>
      </div>
    {% endif %}
  </div>
</a>

{% schema %}
{
  "name": "Page tile",
  "settings": [
    {
      "type": "header",
      "content": "Page"
    },
    {
      "type": "page",
      "id": "page",
      "label": "Page"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "info": "Leave blank to use page title"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "info": "Leave blank to use page meta description"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image",
      "info": "Leave blank to use page featured image"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "info": "Leave blank to hide button"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "options": [
        {
          "value": "filled",
          "label": "Filled"
        },
        {
          "value": "outline",
          "label": "Outline"
        },
        {
          "value": "text",
          "label": "Text"
        }
      ],
      "default": "filled"
    },
    {
      "type": "select",
      "id": "button_alignment",
      "label": "Button alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        },
        {
          "value": "full",
          "label": "Full width"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Color"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "Page tile"
    }
  ]
}
{% endschema %}
