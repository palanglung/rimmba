{% doc %}
  @prompt
    A Contact Form section for the Release theme (OS 2.0 compatible).
    
    ────────────────────────────
    1. TITLE & DESCRIPTION
    
    - Title (hidden if empty) [h2 | h3 | h4 | h5]-default"h2";
    - Description (hidden if empty);
    - Title & Description alignment [Start | Center | End]-default"Center";
    
    ────────────────────────────
    2. CONTAINER
    
    - Layout Type [Normal | Split]-default"Normal";
    
    Layout behavior:
    
    Normal:
    All enabled fields follow Fields Columns setting.
    Message spans full width.
    
    Split:
    Section divided into two equal-width columns.
    Left column = all enabled fields except Message.
    Right column = Message + Button.
    Both columns must be equal height.
    Message textarea must stretch to fill available vertical space of its column.
    Do NOT set fixed height on textarea.
    Height must be determined by layout (flex/grid).
    Fields Columns setting is ignored in Split.
    
    Mobile:
    Always collapse to single column.
    Render fields in order with Message last and Button under Message.
    
    - Fields Columns [1 | 2 | 3]-default"1";
    (Used only when Layout = Normal)
    1 = single column.
    2 = two equal columns.
    3 = three equal columns.
    
    - Container Width [narrow | fluid | full]-default"Narrow";
    - Container Color Scheme [select];
    - Spacing top [No | S | M | L | XL]-default"M";
    - Spacing bottom [No | S | M | L | XL]-default"M";
    - Padding [No | S | M | L | XL]-default"M";
    - Internal spacing between fields [No | S | M | L | XL]-default"M";
    
    Button:
    - Label-default"Send message";
    - Style [filled | outlined | text]-default"filled";
    - Alignment [left | center | right | full]-default"left";
    
    Button rules:
    - Must use Release theme native button classes;
    - No custom CSS;
    - Must inherit Container Color Scheme;
    - Must use same spacing logic as fields (no extra margin);
    - Example:
      class="button button--filled uppercase color-scheme-X";
    
    ────────────────────────────
    3. FIELDS
    
    Fields Color Scheme [select];
    
    IMPORTANT:
    Apply the selected Fields Color Scheme class ONLY to input, textarea, and select elements.
    Do NOT apply it to the form, wrapper div, grid, or column containers.
    
    Each field:
    - Show [Yes | No]-default"Yes";
    - Required [Yes | No]-default"No";
    - Custom label;
    - Custom placeholder;
    
    Fields:
    - Name;
    - Surname;
    - Email (keep native email validation);
    - Phone;
    - Subject;
    - Message (textarea);
    
    Field rules:
    - Field renders only if Show = Yes;
    - Required attribute applied only if enabled;
    - No forced required fields;
    - Use Shopify native {% form 'contact' %};
    
    ────────────────────────────
    FORM BEHAVIOR
    
    - Use Shopify native contact handling;
    - Show validation errors and success message;
    - Follow theme styling;
    - Fully OS 2.0 compatible;
    - No unnecessary custom CSS., What you have provided is not acceptable, do over.
{% enddoc %}
{% liquid
  assign spacing_top_map = 'no:0,s:1,m:2,l:3,xl:4' | split: ','
  assign spacing_bottom_map = 'no:0,s:1,m:2,l:3,xl:4' | split: ','
  assign padding_map = 'no:0,s:1,m:2,l:3,xl:4' | split: ','
  assign internal_map = 'no:0,s:1,m:2,l:3,xl:4' | split: ','

  for item in spacing_top_map
    assign parts = item | split: ':'
    if parts[0] == section.settings.spacing_top
      assign top_class = parts[1]
    endif
  endfor

  for item in spacing_bottom_map
    assign parts = item | split: ':'
    if parts[0] == section.settings.spacing_bottom
      assign bottom_class = parts[1]
    endif
  endfor

  for item in padding_map
    assign parts = item | split: ':'
    if parts[0] == section.settings.padding
      assign padding_class = parts[1]
    endif
  endfor

  for item in internal_map
    assign parts = item | split: ':'
    if parts[0] == section.settings.internal_spacing
      assign gap_multiplier = parts[1]
    endif
  endfor
%}

<div class="section section--padding-{{ top_class }}-{{ bottom_class }} section--padding-{{ padding_class }} color-scheme-{{ section.settings.container_color_scheme }}">
  <div class="{% if section.settings.container_width == 'narrow' %}container container--narrow{% elsif section.settings.container_width == 'fluid' %}container{% else %}container--full-width{% endif %}">
    
    {% if section.settings.title != blank or section.settings.description != blank %}
      <div class="section__header text-align-{{ section.settings.title_alignment }}" style="margin-bottom: calc(var(--spacing-unit) * {{ gap_multiplier }});">
        {% if section.settings.title != blank %}
          <{{ section.settings.title_tag }} class="{{ section.settings.title_tag }}">{{ section.settings.title }}</{{ section.settings.title_tag }}>
        {% endif %}
        {% if section.settings.description != blank %}
          <div class="rte" style="margin-top: 1.6rem;">{{ section.settings.description }}</div>
        {% endif %}
      </div>
    {% endif %}

    {% form 'contact' %}
      {% if form.posted_successfully? %}
        <div style="padding: 1.6rem; margin-bottom: calc(var(--spacing-unit) * {{ gap_multiplier }}); background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 0.4rem;">
          {{ 'contact.form.post_success' | t }}
        </div>
      {% endif %}

      {% if form.errors %}
        <div style="padding: 1.6rem; margin-bottom: calc(var(--spacing-unit) * {{ gap_multiplier }}); background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 0.4rem;">
          {{ form.errors | default_errors }}
        </div>
      {% endif %}

      {% if section.settings.layout_type == 'split' %}
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: calc(var(--spacing-unit) * {{ gap_multiplier }}); align-items: start;">
          <div style="display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * {{ gap_multiplier }});">
            {% if section.settings.show_name %}
              <div>
                <label for="contact-name" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.name_label }}{% if section.settings.name_required %} *{% endif %}
                </label>
                <input type="text" id="contact-name" name="contact[{{ section.settings.name_label }}]" placeholder="{{ section.settings.name_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.name_required %}required{% endif %}>
              </div>
            {% endif %}

            {% if section.settings.show_surname %}
              <div>
                <label for="contact-surname" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.surname_label }}{% if section.settings.surname_required %} *{% endif %}
                </label>
                <input type="text" id="contact-surname" name="contact[{{ section.settings.surname_label }}]" placeholder="{{ section.settings.surname_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.surname_required %}required{% endif %}>
              </div>
            {% endif %}

            {% if section.settings.show_email %}
              <div>
                <label for="contact-email" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.email_label }}{% if section.settings.email_required %} *{% endif %}
                </label>
                <input type="email" id="contact-email" name="contact[email]" placeholder="{{ section.settings.email_placeholder }}" autocomplete="email" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.email_required %}required{% endif %}>
              </div>
            {% endif %}

            {% if section.settings.show_phone %}
              <div>
                <label for="contact-phone" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.phone_label }}{% if section.settings.phone_required %} *{% endif %}
                </label>
                <input type="tel" id="contact-phone" name="contact[{{ section.settings.phone_label }}]" placeholder="{{ section.settings.phone_placeholder }}" autocomplete="tel" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.phone_required %}required{% endif %}>
              </div>
            {% endif %}

            {% if section.settings.show_subject %}
              <div>
                <label for="contact-subject" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.subject_label }}{% if section.settings.subject_required %} *{% endif %}
                </label>
                <input type="text" id="contact-subject" name="contact[{{ section.settings.subject_label }}]" placeholder="{{ section.settings.subject_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.subject_required %}required{% endif %}>
              </div>
            {% endif %}
          </div>

          <div style="display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * {{ gap_multiplier }}); height: 100%;">
            {% if section.settings.show_message %}
              <div style="flex: 1; display: flex; flex-direction: column;">
                <label for="contact-message" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                  {{ section.settings.message_label }}{% if section.settings.message_required %} *{% endif %}
                </label>
                <textarea id="contact-message" name="contact[body]" placeholder="{{ section.settings.message_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" style="flex: 1; min-height: 200px; resize: vertical;" {% if section.settings.message_required %}required{% endif %}></textarea>
              </div>
            {% endif %}

            <div style="{% if section.settings.button_alignment == 'center' %}text-align: center;{% elsif section.settings.button_alignment == 'right' %}text-align: right;{% elsif section.settings.button_alignment == 'full' %}width: 100%;{% else %}text-align: left;{% endif %}">
              <button type="submit" class="button button--{{ section.settings.button_style }} {{ section.settings.button_text_transform }}" {% if section.settings.button_alignment == 'full' %}style="width: 100%;"{% endif %}>
                {{ section.settings.button_label }}
              </button>
            </div>
          </div>
        </div>

        <style>
          @media screen and (max-width: 749px) {
            .section .container > form > div[style*="grid-template-columns: 1fr 1fr"] {
              grid-template-columns: 1fr !important;
            }
            .section .container > form > div > div[style*="height: 100%"] textarea {
              min-height: 150px !important;
            }
          }
        </style>

      {% else %}
        <div style="display: grid; grid-template-columns: repeat({{ section.settings.fields_columns }}, 1fr); gap: calc(var(--spacing-unit) * {{ gap_multiplier }});">
          {% if section.settings.show_name %}
            <div>
              <label for="contact-name" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.name_label }}{% if section.settings.name_required %} *{% endif %}
              </label>
              <input type="text" id="contact-name" name="contact[{{ section.settings.name_label }}]" placeholder="{{ section.settings.name_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.name_required %}required{% endif %}>
            </div>
          {% endif %}

          {% if section.settings.show_surname %}
            <div>
              <label for="contact-surname" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.surname_label }}{% if section.settings.surname_required %} *{% endif %}
              </label>
              <input type="text" id="contact-surname" name="contact[{{ section.settings.surname_label }}]" placeholder="{{ section.settings.surname_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.surname_required %}required{% endif %}>
            </div>
          {% endif %}

          {% if section.settings.show_email %}
            <div>
              <label for="contact-email" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.email_label }}{% if section.settings.email_required %} *{% endif %}
              </label>
              <input type="email" id="contact-email" name="contact[email]" placeholder="{{ section.settings.email_placeholder }}" autocomplete="email" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.email_required %}required{% endif %}>
            </div>
          {% endif %}

          {% if section.settings.show_phone %}
            <div>
              <label for="contact-phone" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.phone_label }}{% if section.settings.phone_required %} *{% endif %}
              </label>
              <input type="tel" id="contact-phone" name="contact[{{ section.settings.phone_label }}]" placeholder="{{ section.settings.phone_placeholder }}" autocomplete="tel" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.phone_required %}required{% endif %}>
            </div>
          {% endif %}

          {% if section.settings.show_subject %}
            <div>
              <label for="contact-subject" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.subject_label }}{% if section.settings.subject_required %} *{% endif %}
              </label>
              <input type="text" id="contact-subject" name="contact[{{ section.settings.subject_label }}]" placeholder="{{ section.settings.subject_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.subject_required %}required{% endif %}>
            </div>
          {% endif %}

          {% if section.settings.show_message %}
            <div style="grid-column: 1 / -1;">
              <label for="contact-message" style="display: block; margin-bottom: 0.8rem; font-size: 1.4rem;">
                {{ section.settings.message_label }}{% if section.settings.message_required %} *{% endif %}
              </label>
              <textarea id="contact-message" name="contact[body]" rows="6" placeholder="{{ section.settings.message_placeholder }}" class="color-scheme-{{ section.settings.fields_color_scheme }}" {% if section.settings.message_required %}required{% endif %}></textarea>
            </div>
          {% endif %}
        </div>

        <div style="margin-top: calc(var(--spacing-unit) * {{ gap_multiplier }}); {% if section.settings.button_alignment == 'center' %}text-align: center;{% elsif section.settings.button_alignment == 'right' %}text-align: right;{% elsif section.settings.button_alignment == 'full' %}width: 100%;{% else %}text-align: left;{% endif %}">
          <button type="submit" class="button button--{{ section.settings.button_style }} {{ section.settings.button_text_transform }}" {% if section.settings.button_alignment == 'full' %}style="width: 100%;"{% endif %}>
            {{ section.settings.button_label }}
          </button>
        </div>

        <style>
          @media screen and (max-width: 749px) {
            .section .container > form > div[style*="grid-template-columns"] {
              grid-template-columns: 1fr !important;
            }
          }
        </style>
      {% endif %}
    {% endform %}
  </div>
</div>

{% schema %}
{
  "name": "Contact form",
  "settings": [
    {
      "type": "header",
      "content": "Title & description"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "select",
      "id": "title_tag",
      "label": "Title tag",
      "options": [
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "h4", "label": "H4" },
        { "value": "h5", "label": "H5" }
      ],
      "default": "h2"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title & description alignment",
      "options": [
        { "value": "start", "label": "Start" },
        { "value": "center", "label": "Center" },
        { "value": "end", "label": "End" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Container"
    },
    {
      "type": "select",
      "id": "layout_type",
      "label": "Layout type",
      "options": [
        { "value": "normal", "label": "Normal" },
        { "value": "split", "label": "Split" }
      ],
      "default": "normal"
    },
    {
      "type": "select",
      "id": "fields_columns",
      "label": "Fields columns",
      "info": "Used only when Layout = Normal",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ],
      "default": "1"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        { "value": "narrow", "label": "Narrow" },
        { "value": "fluid", "label": "Fluid" },
        { "value": "full", "label": "Full" }
      ],
      "default": "narrow"
    },
    {
      "type": "color_scheme",
      "id": "container_color_scheme",
      "label": "Container color scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "spacing_top",
      "label": "Spacing top",
      "options": [
        { "value": "no", "label": "No" },
        { "value": "s", "label": "S" },
        { "value": "m", "label": "M" },
        { "value": "l", "label": "L" },
        { "value": "xl", "label": "XL" }
      ],
      "default": "m"
    },
    {
      "type": "select",
      "id": "spacing_bottom",
      "label": "Spacing bottom",
      "options": [
        { "value": "no", "label": "No" },
        { "value": "s", "label": "S" },
        { "value": "m", "label": "M" },
        { "value": "l", "label": "L" },
        { "value": "xl", "label": "XL" }
      ],
      "default": "m"
    },
    {
      "type": "select",
      "id": "padding",
      "label": "Padding",
      "options": [
        { "value": "no", "label": "No" },
        { "value": "s", "label": "S" },
        { "value": "m", "label": "M" },
        { "value": "l", "label": "L" },
        { "value": "xl", "label": "XL" }
      ],
      "default": "m"
    },
    {
      "type": "select",
      "id": "internal_spacing",
      "label": "Internal spacing between fields",
      "options": [
        { "value": "no", "label": "No" },
        { "value": "s", "label": "S" },
        { "value": "m", "label": "M" },
        { "value": "l", "label": "L" },
        { "value": "xl", "label": "XL" }
      ],
      "default": "m"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Label",
      "default": "Send message"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Style",
      "options": [
        { "value": "filled", "label": "Filled" },
        { "value": "outlined", "label": "Outlined" },
        { "value": "text", "label": "Text" }
      ],
      "default": "filled"
    },
    {
      "type": "select",
      "id": "button_alignment",
      "label": "Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" },
        { "value": "full", "label": "Full" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "button_text_transform",
      "label": "Text transform",
      "options": [
        { "value": "", "label": "None" },
        { "value": "uppercase", "label": "Uppercase" }
      ],
      "default": "uppercase"
    },
    {
      "type": "header",
      "content": "Fields"
    },
    {
      "type": "color_scheme",
      "id": "fields_color_scheme",
      "label": "Fields color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Name field"
    },
    {
      "type": "checkbox",
      "id": "show_name",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "name_required",
      "label": "Required",
      "default": false
    },
    {
      "type": "text",
      "id": "name_label",
      "label": "Custom label",
      "default": "Name"
    },
    {
      "type": "text",
      "id": "name_placeholder",
      "label": "Custom placeholder"
    },
    {
      "type": "header",
      "content": "Surname field"
    },
    {
      "type": "checkbox",
      "id": "show_surname",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "surname_required",
      "label": "Required",
      "default": false
    },
    {
      "type": "text",
      "id": "surname_label",
      "label": "Custom label",
      "default": "Surname"
    },
    {
      "type": "text",
      "id": "surname_placeholder",
      "label": "Custom placeholder"
    },
    {
      "type": "header",
      "content": "Email field"
    },
    {
      "type": "checkbox",
      "id": "show_email",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "email_required",
      "label": "Required",
      "default": true
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Custom label",
      "default": "Email"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Custom placeholder"
    },
    {
      "type": "header",
      "content": "Phone field"
    },
    {
      "type": "checkbox",
      "id": "show_phone",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "phone_required",
      "label": "Required",
      "default": false
    },
    {
      "type": "text",
      "id": "phone_label",
      "label": "Custom label",
      "default": "Phone"
    },
    {
      "type": "text",
      "id": "phone_placeholder",
      "label": "Custom placeholder"
    },
    {
      "type": "header",
      "content": "Subject field"
    },
    {
      "type": "checkbox",
      "id": "show_subject",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "subject_required",
      "label": "Required",
      "default": false
    },
    {
      "type": "text",
      "id": "subject_label",
      "label": "Custom label",
      "default": "Subject"
    },
    {
      "type": "text",
      "id": "subject_placeholder",
      "label": "Custom placeholder"
    },
    {
      "type": "header",
      "content": "Message field"
    },
    {
      "type": "checkbox",
      "id": "show_message",
      "label": "Show",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "message_required",
      "label": "Required",
      "default": true
    },
    {
      "type": "text",
      "id": "message_label",
      "label": "Custom label",
      "default": "Message"
    },
    {
      "type": "text",
      "id": "message_placeholder",
      "label": "Custom placeholder"
    }
  ],
  "presets": [
    {
      "name": "Contact form"
    }
  ]
}
{% endschema %}
